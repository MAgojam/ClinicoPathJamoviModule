
# This file is automatically generated, you probably don't want to edit this

jextractstatsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jextractstatsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            analysis_type = "between_stats",
            x_var = NULL,
            y_var = NULL,
            paired_var = NULL,
            extract_subtitle = TRUE,
            extract_caption = TRUE,
            extract_pairwise = TRUE,
            extract_descriptive = TRUE,
            show_raw_data = FALSE,
            show_formatted_results = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="jextractstats",
                requiresData=TRUE,
                ...)

            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "between_stats",
                    "within_stats",
                    "correlation_stats",
                    "contingency_stats",
                    "one_sample_stats"),
                default="between_stats")
            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "nominal",
                    "ordinal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..paired_var <- jmvcore::OptionVariable$new(
                "paired_var",
                paired_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..extract_subtitle <- jmvcore::OptionBool$new(
                "extract_subtitle",
                extract_subtitle,
                default=TRUE)
            private$..extract_caption <- jmvcore::OptionBool$new(
                "extract_caption",
                extract_caption,
                default=TRUE)
            private$..extract_pairwise <- jmvcore::OptionBool$new(
                "extract_pairwise",
                extract_pairwise,
                default=TRUE)
            private$..extract_descriptive <- jmvcore::OptionBool$new(
                "extract_descriptive",
                extract_descriptive,
                default=TRUE)
            private$..show_raw_data <- jmvcore::OptionBool$new(
                "show_raw_data",
                show_raw_data,
                default=FALSE)
            private$..show_formatted_results <- jmvcore::OptionBool$new(
                "show_formatted_results",
                show_formatted_results,
                default=TRUE)

            self$.addOption(private$..analysis_type)
            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..paired_var)
            self$.addOption(private$..extract_subtitle)
            self$.addOption(private$..extract_caption)
            self$.addOption(private$..extract_pairwise)
            self$.addOption(private$..extract_descriptive)
            self$.addOption(private$..show_raw_data)
            self$.addOption(private$..show_formatted_results)
        }),
    active = list(
        analysis_type = function() private$..analysis_type$value,
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        paired_var = function() private$..paired_var$value,
        extract_subtitle = function() private$..extract_subtitle$value,
        extract_caption = function() private$..extract_caption$value,
        extract_pairwise = function() private$..extract_pairwise$value,
        extract_descriptive = function() private$..extract_descriptive$value,
        show_raw_data = function() private$..show_raw_data$value,
        show_formatted_results = function() private$..show_formatted_results$value),
    private = list(
        ..analysis_type = NA,
        ..x_var = NA,
        ..y_var = NA,
        ..paired_var = NA,
        ..extract_subtitle = NA,
        ..extract_caption = NA,
        ..extract_pairwise = NA,
        ..extract_descriptive = NA,
        ..show_raw_data = NA,
        ..show_formatted_results = NA)
)

jextractstatsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jextractstatsResults",
    inherit = jmvcore::Group,
    active = list(
        text = function() private$.items[["text"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="JJStatsPlot")
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="text",
                title="JJStatsPlot"))}))

jextractstatsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jextractstatsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jextractstats",
                version = c(0,0,3),
                options = options,
                results = jextractstatsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Statistical Data Extraction from ggstatsplot
#'
#' Extract detailed statistical information from ggstatsplot analyses using 
#' statsExpressions package for comprehensive data frame outputs.
#'
#' @examples
#' \donttest{
#' # Example usage:
#' library(ggstatsplot)
#' library(statsExpressions)
#' # Extract statistical details
#' extract_stats(ggbetweenstats(data, x, y))
#'}
#' @param data The data as a data frame.
#' @param analysis_type Type of statistical analysis to perform and extract.
#' @param x_var Independent variable or grouping variable.
#' @param y_var Dependent variable or outcome variable.
#' @param paired_var Subject identifier for paired/repeated measures.
#' @param extract_subtitle Extract statistical details used in plot subtitles.
#' @param extract_caption Extract statistical details used in plot captions.
#' @param extract_pairwise Extract pairwise comparison results.
#' @param extract_descriptive Extract descriptive statistics summary.
#' @param show_raw_data Display raw extracted statistical data frames.
#' @param show_formatted_results Display formatted statistical results.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$text} \tab \tab \tab \tab \tab a preformatted \cr
#' }
#'
#' @export
jextractstats <- function(
    data,
    analysis_type = "between_stats",
    x_var,
    y_var,
    paired_var,
    extract_subtitle = TRUE,
    extract_caption = TRUE,
    extract_pairwise = TRUE,
    extract_descriptive = TRUE,
    show_raw_data = FALSE,
    show_formatted_results = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jextractstats requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(paired_var)) paired_var <- jmvcore::resolveQuo(jmvcore::enquo(paired_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(paired_var), paired_var, NULL))

    for (v in paired_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jextractstatsOptions$new(
        analysis_type = analysis_type,
        x_var = x_var,
        y_var = y_var,
        paired_var = paired_var,
        extract_subtitle = extract_subtitle,
        extract_caption = extract_caption,
        extract_pairwise = extract_pairwise,
        extract_descriptive = extract_descriptive,
        show_raw_data = show_raw_data,
        show_formatted_results = show_formatted_results)

    analysis <- jextractstatsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

