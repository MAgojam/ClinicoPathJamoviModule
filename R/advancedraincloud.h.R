
# This file is automatically generated, you probably don't want to edit this

advancedraincloudOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedraincloudOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            y_var = NULL,
            x_var = NULL,
            fill_var = NULL,
            id_var = NULL,
            cov_var = NULL,
            rain_side = "l",
            likert_mode = FALSE,
            show_longitudinal = FALSE,
            point_size = 1.5,
            point_alpha = 0.7,
            violin_alpha = 0.7,
            boxplot_width = 0.1,
            color_palette = "clinical",
            plot_title = "Advanced Raincloud Plot",
            x_label = "",
            y_label = "",
            show_statistics = TRUE,
            show_comparisons = FALSE,
            show_interpretation = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="advancedraincloud",
                requiresData=TRUE,
                ...)

            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..fill_var <- jmvcore::OptionVariable$new(
                "fill_var",
                fill_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..id_var <- jmvcore::OptionVariable$new(
                "id_var",
                id_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric",
                    "id"))
            private$..cov_var <- jmvcore::OptionVariable$new(
                "cov_var",
                cov_var,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..rain_side <- jmvcore::OptionList$new(
                "rain_side",
                rain_side,
                options=list(
                    "l",
                    "r",
                    "f"),
                default="l")
            private$..likert_mode <- jmvcore::OptionBool$new(
                "likert_mode",
                likert_mode,
                default=FALSE)
            private$..show_longitudinal <- jmvcore::OptionBool$new(
                "show_longitudinal",
                show_longitudinal,
                default=FALSE)
            private$..point_size <- jmvcore::OptionNumber$new(
                "point_size",
                point_size,
                min=0.1,
                max=5,
                default=1.5)
            private$..point_alpha <- jmvcore::OptionNumber$new(
                "point_alpha",
                point_alpha,
                min=0,
                max=1,
                default=0.7)
            private$..violin_alpha <- jmvcore::OptionNumber$new(
                "violin_alpha",
                violin_alpha,
                min=0,
                max=1,
                default=0.7)
            private$..boxplot_width <- jmvcore::OptionNumber$new(
                "boxplot_width",
                boxplot_width,
                min=0.1,
                max=1,
                default=0.1)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "clinical",
                    "viridis",
                    "set1",
                    "set2",
                    "pastel",
                    "dark2"),
                default="clinical")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="Advanced Raincloud Plot")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=TRUE)
            private$..show_comparisons <- jmvcore::OptionBool$new(
                "show_comparisons",
                show_comparisons,
                default=FALSE)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)

            self$.addOption(private$..y_var)
            self$.addOption(private$..x_var)
            self$.addOption(private$..fill_var)
            self$.addOption(private$..id_var)
            self$.addOption(private$..cov_var)
            self$.addOption(private$..rain_side)
            self$.addOption(private$..likert_mode)
            self$.addOption(private$..show_longitudinal)
            self$.addOption(private$..point_size)
            self$.addOption(private$..point_alpha)
            self$.addOption(private$..violin_alpha)
            self$.addOption(private$..boxplot_width)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..show_comparisons)
            self$.addOption(private$..show_interpretation)
        }),
    active = list(
        y_var = function() private$..y_var$value,
        x_var = function() private$..x_var$value,
        fill_var = function() private$..fill_var$value,
        id_var = function() private$..id_var$value,
        cov_var = function() private$..cov_var$value,
        rain_side = function() private$..rain_side$value,
        likert_mode = function() private$..likert_mode$value,
        show_longitudinal = function() private$..show_longitudinal$value,
        point_size = function() private$..point_size$value,
        point_alpha = function() private$..point_alpha$value,
        violin_alpha = function() private$..violin_alpha$value,
        boxplot_width = function() private$..boxplot_width$value,
        color_palette = function() private$..color_palette$value,
        plot_title = function() private$..plot_title$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        show_statistics = function() private$..show_statistics$value,
        show_comparisons = function() private$..show_comparisons$value,
        show_interpretation = function() private$..show_interpretation$value),
    private = list(
        ..y_var = NA,
        ..x_var = NA,
        ..fill_var = NA,
        ..id_var = NA,
        ..cov_var = NA,
        ..rain_side = NA,
        ..likert_mode = NA,
        ..show_longitudinal = NA,
        ..point_size = NA,
        ..point_alpha = NA,
        ..violin_alpha = NA,
        ..boxplot_width = NA,
        ..color_palette = NA,
        ..plot_title = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..show_statistics = NA,
        ..show_comparisons = NA,
        ..show_interpretation = NA)
)

advancedraincloudResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedraincloudResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        plot = function() private$.items[["plot"]],
        statistics = function() private$.items[["statistics"]],
        comparisons = function() private$.items[["comparisons"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Advanced Raincloud Plot")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Advanced Raincloud Plot",
                width=800,
                height=600,
                renderFun=".plot"))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistics",
                title="Summary Statistics",
                visible="(show_statistics)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="comparisons",
                title="Group Comparisons",
                visible="(show_comparisons)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Feature Guide",
                visible="(show_interpretation)"))}))

advancedraincloudBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedraincloudBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "advancedraincloud",
                version = c(0,0,3),
                options = options,
                results = advancedraincloudResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Advanced Raincloud Plot
#'
#' 
#' @param data The data as a data frame.
#' @param y_var Continuous variable for distribution visualization on Y-axis.
#' @param x_var Grouping variable for X-axis categories.
#' @param fill_var Optional variable for color filling different groups.
#' @param id_var Optional ID variable for connecting longitudinal observations
#'   across groups.
#' @param cov_var Optional variable for remapping point colors based on
#'   covariate values.
#' @param rain_side Position of the raincloud relative to the data points.
#' @param likert_mode If TRUE, adds Y-axis jittering for Likert scale or
#'   ordinal data.
#' @param show_longitudinal If TRUE, connects repeated observations using the
#'   ID variable.
#' @param point_size Size of individual data points.
#' @param point_alpha Transparency level for data points.
#' @param violin_alpha Transparency level for violin plots.
#' @param boxplot_width Width of the boxplot component.
#' @param color_palette Color palette for different groups.
#' @param plot_title Title for the raincloud plot.
#' @param x_label Custom label for X-axis. If empty, uses variable name.
#' @param y_label Custom label for Y-axis. If empty, uses variable name.
#' @param show_statistics If TRUE, displays summary statistics table.
#' @param show_comparisons If TRUE, performs statistical tests between groups.
#' @param show_interpretation If TRUE, displays interpretation and feature
#'   guide.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$comparisons} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
advancedraincloud <- function(
    data,
    y_var,
    x_var,
    fill_var,
    id_var,
    cov_var,
    rain_side = "l",
    likert_mode = FALSE,
    show_longitudinal = FALSE,
    point_size = 1.5,
    point_alpha = 0.7,
    violin_alpha = 0.7,
    boxplot_width = 0.1,
    color_palette = "clinical",
    plot_title = "Advanced Raincloud Plot",
    x_label = "",
    y_label = "",
    show_statistics = TRUE,
    show_comparisons = FALSE,
    show_interpretation = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("advancedraincloud requires jmvcore to be installed (restart may be required)")

    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(fill_var)) fill_var <- jmvcore::resolveQuo(jmvcore::enquo(fill_var))
    if ( ! missing(id_var)) id_var <- jmvcore::resolveQuo(jmvcore::enquo(id_var))
    if ( ! missing(cov_var)) cov_var <- jmvcore::resolveQuo(jmvcore::enquo(cov_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(fill_var), fill_var, NULL),
            `if`( ! missing(id_var), id_var, NULL),
            `if`( ! missing(cov_var), cov_var, NULL))


    options <- advancedraincloudOptions$new(
        y_var = y_var,
        x_var = x_var,
        fill_var = fill_var,
        id_var = id_var,
        cov_var = cov_var,
        rain_side = rain_side,
        likert_mode = likert_mode,
        show_longitudinal = show_longitudinal,
        point_size = point_size,
        point_alpha = point_alpha,
        violin_alpha = violin_alpha,
        boxplot_width = boxplot_width,
        color_palette = color_palette,
        plot_title = plot_title,
        x_label = x_label,
        y_label = y_label,
        show_statistics = show_statistics,
        show_comparisons = show_comparisons,
        show_interpretation = show_interpretation)

    analysis <- advancedraincloudClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

