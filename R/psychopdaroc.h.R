
# This file is automatically generated, you probably don't want to edit this

psychopdarocOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "psychopdarocOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            dependentVars = NULL,
            classVar = NULL,
            positiveClass = NULL,
            subGroup = NULL,
            method = "maximize_metric",
            specifyCutScore = "",
            metric = "youden",
            direction = ">=",
            allObserved = FALSE,
            break_ties = "mean",
            tol_metric = 0.05,
            boot_runs = 0,
            costRatioFP = 1,
            plotROC = TRUE,
            combinePlots = TRUE,
            showOptimalPoint = TRUE,
            cleanPlot = FALSE,
            legendPosition = "right",
            delongTest = FALSE,
            calculateIDI = FALSE,
            calculateNRI = FALSE,
            refVar = NULL,
            nriThresholds = "",
            idiNriBootRuns = 1000,
            sensSpecTable = FALSE,
            showThresholdTable = FALSE,
            maxThresholds = 20,
            showCriterionPlot = FALSE,
            showPrevalencePlot = FALSE,
            showDotPlot = FALSE,
            precisionRecallCurve = FALSE,
            partialAUC = FALSE,
            partialAUCfrom = 0.8,
            partialAUCto = 1,
            rocSmoothingMethod = "none",
            bootstrapCI = FALSE,
            bootstrapReps = 2000,
            compareClassifiers = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="psychopdaroc",
                requiresData=TRUE,
                ...)

            private$..dependentVars <- jmvcore::OptionVariables$new(
                "dependentVars",
                dependentVars,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..classVar <- jmvcore::OptionVariable$new(
                "classVar",
                classVar,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..positiveClass <- jmvcore::OptionLevel$new(
                "positiveClass",
                positiveClass,
                variable="(classVar)")
            private$..subGroup <- jmvcore::OptionVariable$new(
                "subGroup",
                subGroup,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..method <- jmvcore::OptionList$new(
                "method",
                method,
                options=list(
                    "maximize_metric",
                    "minimize_metric",
                    "oc_manual",
                    "maximize_loess_metric",
                    "minimize_loess_metric",
                    "maximize_spline_metric",
                    "minimize_spline_metric",
                    "maximize_boot_metric",
                    "minimize_boot_metric",
                    "oc_youden_kernel",
                    "oc_youden_normal",
                    "oc_cost_ratio",
                    "oc_equal_sens_spec",
                    "oc_closest_01"),
                default="maximize_metric")
            private$..specifyCutScore <- jmvcore::OptionString$new(
                "specifyCutScore",
                specifyCutScore,
                default="")
            private$..metric <- jmvcore::OptionList$new(
                "metric",
                metric,
                options=list(
                    "youden",
                    "sum_sens_spec",
                    "accuracy",
                    "sum_ppv_npv",
                    "prod_sens_spec",
                    "prod_ppv_npv",
                    "cohens_kappa",
                    "abs_d_sens_spec",
                    "roc01",
                    "abs_d_ppv_npv",
                    "F1_score"),
                default="youden")
            private$..direction <- jmvcore::OptionList$new(
                "direction",
                direction,
                options=list(
                    ">=",
                    "<="),
                default=">=")
            private$..allObserved <- jmvcore::OptionBool$new(
                "allObserved",
                allObserved,
                default=FALSE)
            private$..break_ties <- jmvcore::OptionList$new(
                "break_ties",
                break_ties,
                options=list(
                    "mean",
                    "median",
                    "c"),
                default="mean")
            private$..tol_metric <- jmvcore::OptionNumber$new(
                "tol_metric",
                tol_metric,
                default=0.05,
                min=0.001,
                max=0.5)
            private$..boot_runs <- jmvcore::OptionNumber$new(
                "boot_runs",
                boot_runs,
                default=0,
                min=0,
                max=10000)
            private$..costRatioFP <- jmvcore::OptionNumber$new(
                "costRatioFP",
                costRatioFP,
                default=1,
                min=0.01,
                max=100)
            private$..plotROC <- jmvcore::OptionBool$new(
                "plotROC",
                plotROC,
                default=TRUE)
            private$..combinePlots <- jmvcore::OptionBool$new(
                "combinePlots",
                combinePlots,
                default=TRUE)
            private$..showOptimalPoint <- jmvcore::OptionBool$new(
                "showOptimalPoint",
                showOptimalPoint,
                default=TRUE)
            private$..cleanPlot <- jmvcore::OptionBool$new(
                "cleanPlot",
                cleanPlot,
                default=FALSE)
            private$..legendPosition <- jmvcore::OptionList$new(
                "legendPosition",
                legendPosition,
                options=list(
                    "right",
                    "bottom",
                    "top",
                    "left",
                    "none"),
                default="right")
            private$..delongTest <- jmvcore::OptionBool$new(
                "delongTest",
                delongTest,
                default=FALSE)
            private$..calculateIDI <- jmvcore::OptionBool$new(
                "calculateIDI",
                calculateIDI,
                default=FALSE)
            private$..calculateNRI <- jmvcore::OptionBool$new(
                "calculateNRI",
                calculateNRI,
                default=FALSE)
            private$..refVar <- jmvcore::OptionLevel$new(
                "refVar",
                refVar,
                variable="(dependentVars)")
            private$..nriThresholds <- jmvcore::OptionString$new(
                "nriThresholds",
                nriThresholds,
                default="")
            private$..idiNriBootRuns <- jmvcore::OptionNumber$new(
                "idiNriBootRuns",
                idiNriBootRuns,
                default=1000,
                min=100,
                max=10000)
            private$..sensSpecTable <- jmvcore::OptionBool$new(
                "sensSpecTable",
                sensSpecTable,
                default=FALSE)
            private$..showThresholdTable <- jmvcore::OptionBool$new(
                "showThresholdTable",
                showThresholdTable,
                default=FALSE)
            private$..maxThresholds <- jmvcore::OptionNumber$new(
                "maxThresholds",
                maxThresholds,
                default=20,
                min=5,
                max=100)
            private$..showCriterionPlot <- jmvcore::OptionBool$new(
                "showCriterionPlot",
                showCriterionPlot,
                default=FALSE)
            private$..showPrevalencePlot <- jmvcore::OptionBool$new(
                "showPrevalencePlot",
                showPrevalencePlot,
                default=FALSE)
            private$..showDotPlot <- jmvcore::OptionBool$new(
                "showDotPlot",
                showDotPlot,
                default=FALSE)
            private$..precisionRecallCurve <- jmvcore::OptionBool$new(
                "precisionRecallCurve",
                precisionRecallCurve,
                default=FALSE)
            private$..partialAUC <- jmvcore::OptionBool$new(
                "partialAUC",
                partialAUC,
                default=FALSE)
            private$..partialAUCfrom <- jmvcore::OptionNumber$new(
                "partialAUCfrom",
                partialAUCfrom,
                default=0.8,
                min=0,
                max=1)
            private$..partialAUCto <- jmvcore::OptionNumber$new(
                "partialAUCto",
                partialAUCto,
                default=1,
                min=0,
                max=1)
            private$..rocSmoothingMethod <- jmvcore::OptionList$new(
                "rocSmoothingMethod",
                rocSmoothingMethod,
                options=list(
                    "none",
                    "binormal",
                    "density",
                    "fitdistr"),
                default="none")
            private$..bootstrapCI <- jmvcore::OptionBool$new(
                "bootstrapCI",
                bootstrapCI,
                default=FALSE)
            private$..bootstrapReps <- jmvcore::OptionNumber$new(
                "bootstrapReps",
                bootstrapReps,
                default=2000,
                min=100,
                max=10000)
            private$..compareClassifiers <- jmvcore::OptionBool$new(
                "compareClassifiers",
                compareClassifiers,
                default=FALSE)

            self$.addOption(private$..dependentVars)
            self$.addOption(private$..classVar)
            self$.addOption(private$..positiveClass)
            self$.addOption(private$..subGroup)
            self$.addOption(private$..method)
            self$.addOption(private$..specifyCutScore)
            self$.addOption(private$..metric)
            self$.addOption(private$..direction)
            self$.addOption(private$..allObserved)
            self$.addOption(private$..break_ties)
            self$.addOption(private$..tol_metric)
            self$.addOption(private$..boot_runs)
            self$.addOption(private$..costRatioFP)
            self$.addOption(private$..plotROC)
            self$.addOption(private$..combinePlots)
            self$.addOption(private$..showOptimalPoint)
            self$.addOption(private$..cleanPlot)
            self$.addOption(private$..legendPosition)
            self$.addOption(private$..delongTest)
            self$.addOption(private$..calculateIDI)
            self$.addOption(private$..calculateNRI)
            self$.addOption(private$..refVar)
            self$.addOption(private$..nriThresholds)
            self$.addOption(private$..idiNriBootRuns)
            self$.addOption(private$..sensSpecTable)
            self$.addOption(private$..showThresholdTable)
            self$.addOption(private$..maxThresholds)
            self$.addOption(private$..showCriterionPlot)
            self$.addOption(private$..showPrevalencePlot)
            self$.addOption(private$..showDotPlot)
            self$.addOption(private$..precisionRecallCurve)
            self$.addOption(private$..partialAUC)
            self$.addOption(private$..partialAUCfrom)
            self$.addOption(private$..partialAUCto)
            self$.addOption(private$..rocSmoothingMethod)
            self$.addOption(private$..bootstrapCI)
            self$.addOption(private$..bootstrapReps)
            self$.addOption(private$..compareClassifiers)
        }),
    active = list(
        dependentVars = function() private$..dependentVars$value,
        classVar = function() private$..classVar$value,
        positiveClass = function() private$..positiveClass$value,
        subGroup = function() private$..subGroup$value,
        method = function() private$..method$value,
        specifyCutScore = function() private$..specifyCutScore$value,
        metric = function() private$..metric$value,
        direction = function() private$..direction$value,
        allObserved = function() private$..allObserved$value,
        break_ties = function() private$..break_ties$value,
        tol_metric = function() private$..tol_metric$value,
        boot_runs = function() private$..boot_runs$value,
        costRatioFP = function() private$..costRatioFP$value,
        plotROC = function() private$..plotROC$value,
        combinePlots = function() private$..combinePlots$value,
        showOptimalPoint = function() private$..showOptimalPoint$value,
        cleanPlot = function() private$..cleanPlot$value,
        legendPosition = function() private$..legendPosition$value,
        delongTest = function() private$..delongTest$value,
        calculateIDI = function() private$..calculateIDI$value,
        calculateNRI = function() private$..calculateNRI$value,
        refVar = function() private$..refVar$value,
        nriThresholds = function() private$..nriThresholds$value,
        idiNriBootRuns = function() private$..idiNriBootRuns$value,
        sensSpecTable = function() private$..sensSpecTable$value,
        showThresholdTable = function() private$..showThresholdTable$value,
        maxThresholds = function() private$..maxThresholds$value,
        showCriterionPlot = function() private$..showCriterionPlot$value,
        showPrevalencePlot = function() private$..showPrevalencePlot$value,
        showDotPlot = function() private$..showDotPlot$value,
        precisionRecallCurve = function() private$..precisionRecallCurve$value,
        partialAUC = function() private$..partialAUC$value,
        partialAUCfrom = function() private$..partialAUCfrom$value,
        partialAUCto = function() private$..partialAUCto$value,
        rocSmoothingMethod = function() private$..rocSmoothingMethod$value,
        bootstrapCI = function() private$..bootstrapCI$value,
        bootstrapReps = function() private$..bootstrapReps$value,
        compareClassifiers = function() private$..compareClassifiers$value),
    private = list(
        ..dependentVars = NA,
        ..classVar = NA,
        ..positiveClass = NA,
        ..subGroup = NA,
        ..method = NA,
        ..specifyCutScore = NA,
        ..metric = NA,
        ..direction = NA,
        ..allObserved = NA,
        ..break_ties = NA,
        ..tol_metric = NA,
        ..boot_runs = NA,
        ..costRatioFP = NA,
        ..plotROC = NA,
        ..combinePlots = NA,
        ..showOptimalPoint = NA,
        ..cleanPlot = NA,
        ..legendPosition = NA,
        ..delongTest = NA,
        ..calculateIDI = NA,
        ..calculateNRI = NA,
        ..refVar = NA,
        ..nriThresholds = NA,
        ..idiNriBootRuns = NA,
        ..sensSpecTable = NA,
        ..showThresholdTable = NA,
        ..maxThresholds = NA,
        ..showCriterionPlot = NA,
        ..showPrevalencePlot = NA,
        ..showDotPlot = NA,
        ..precisionRecallCurve = NA,
        ..partialAUC = NA,
        ..partialAUCfrom = NA,
        ..partialAUCto = NA,
        ..rocSmoothingMethod = NA,
        ..bootstrapCI = NA,
        ..bootstrapReps = NA,
        ..compareClassifiers = NA)
)

psychopdarocResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "psychopdarocResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        procedureNotes = function() private$.items[["procedureNotes"]],
        aucSummaryTable = function() private$.items[["aucSummaryTable"]],
        resultsTable = function() private$.items[["resultsTable"]],
        thresholdTable = function() private$.items[["thresholdTable"]],
        sensSpecTable = function() private$.items[["sensSpecTable"]],
        delongComparisonTable = function() private$.items[["delongComparisonTable"]],
        delongTest = function() private$.items[["delongTest"]],
        idiTable = function() private$.items[["idiTable"]],
        nriTable = function() private$.items[["nriTable"]],
        partialAUCTable = function() private$.items[["partialAUCTable"]],
        bootstrapCITable = function() private$.items[["bootstrapCITable"]],
        rocComparisonTable = function() private$.items[["rocComparisonTable"]],
        plotROC = function() private$.items[["plotROC"]],
        criterionPlot = function() private$.items[["criterionPlot"]],
        prevalencePlot = function() private$.items[["prevalencePlot"]],
        dotPlot = function() private$.items[["dotPlot"]],
        precisionRecallPlot = function() private$.items[["precisionRecallPlot"]],
        dotPlotMessage = function() private$.items[["dotPlotMessage"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="ROC Analysis",
                refs=list(
                    "cutpointr",
                    "pROC",
                    "MASS",
                    "plotROC",
                    "boot",
                    "epiR"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="procedureNotes",
                title="Analysis Summary",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="aucSummaryTable",
                title="ROC Analysis Summary",
                visible=TRUE,
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "positiveClass",
                    "subGroup"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Test Variable", 
                        `type`="text"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Array$new(
                options=options,
                name="resultsTable",
                title="Optimal Cutpoints and Performance Metrics",
                visible=TRUE,
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "subGroup",
                    "method",
                    "allObserved",
                    "specifyCutScore",
                    "metric",
                    "direction",
                    "positiveClass"),
                template=jmvcore::Table$new(
                    options=options,
                    rows=0,
                    columns=list(
                        list(
                            `name`="cutpoint", 
                            `title`="Cutpoint", 
                            `type`="number"),
                        list(
                            `name`="sensitivity", 
                            `title`="Sensitivity (%)", 
                            `type`="number", 
                            `format`="pc"),
                        list(
                            `name`="specificity", 
                            `title`="Specificity (%)", 
                            `type`="number", 
                            `format`="pc"),
                        list(
                            `name`="ppv", 
                            `title`="PPV (%)", 
                            `type`="number", 
                            `format`="pc"),
                        list(
                            `name`="npv", 
                            `title`="NPV (%)", 
                            `type`="number", 
                            `format`="pc"),
                        list(
                            `name`="youden", 
                            `title`="Youden's Index", 
                            `type`="number"),
                        list(
                            `name`="AUC", 
                            `title`="AUC", 
                            `type`="number"),
                        list(
                            `name`="metricValue", 
                            `title`="Metric Score", 
                            `type`="number")))))
            self$add(jmvcore::Table$new(
                options=options,
                name="thresholdTable",
                title="Performance Across Multiple Thresholds",
                visible="(showThresholdTable)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "method",
                    "metric",
                    "direction",
                    "positiveClass"),
                columns=list(
                    list(
                        `name`="threshold", 
                        `title`="Threshold", 
                        `type`="number"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="accuracy", 
                        `title`="Accuracy", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="ppv", 
                        `title`="PPV", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="npv", 
                        `title`="NPV", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="plr", 
                        `title`="+LR", 
                        `type`="number"),
                    list(
                        `name`="nlr", 
                        `title`="-LR", 
                        `type`="number"),
                    list(
                        `name`="youden", 
                        `title`="Youden's J", 
                        `type`="number"))))
            self$add(jmvcore::Array$new(
                options=options,
                name="sensSpecTable",
                title="Detailed Confusion Matrices",
                visible="(sensSpecTable)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "subGroup",
                    "method",
                    "allObserved",
                    "specifyCutScore",
                    "metric",
                    "direction",
                    "positiveClass"),
                template=jmvcore::Html$new(
                    options=options)))
            self$add(jmvcore::Table$new(
                options=options,
                name="delongComparisonTable",
                title="DeLong Test - Pairwise AUC Comparisons",
                visible="(delongTest)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "positiveClass"),
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="auc_diff", 
                        `title`="AUC Difference", 
                        `type`="number"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="z", 
                        `title`="Z-statistic", 
                        `type`="number"),
                    list(
                        `name`="p", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="delongTest",
                title="DeLong Test - Detailed Results",
                visible="(delongTest)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "positiveClass")))
            self$add(jmvcore::Table$new(
                options=options,
                name="idiTable",
                title="Integrated Discrimination Improvement (IDI)",
                visible="(calculateIDI)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "refVar",
                    "idiNriBootRuns"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Test Variable", 
                        `type`="text"),
                    list(
                        `name`="refVar", 
                        `title`="Reference Variable", 
                        `type`="text"),
                    list(
                        `name`="idi", 
                        `title`="IDI", 
                        `type`="number"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="nriTable",
                title="Net Reclassification Index (NRI)",
                visible="(calculateNRI)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "refVar",
                    "nriThresholds",
                    "idiNriBootRuns"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Test Variable", 
                        `type`="text"),
                    list(
                        `name`="refVar", 
                        `title`="Reference Variable", 
                        `type`="text"),
                    list(
                        `name`="nri", 
                        `title`="Overall NRI", 
                        `type`="number"),
                    list(
                        `name`="event_nri", 
                        `title`="Event NRI", 
                        `type`="number"),
                    list(
                        `name`="non_event_nri", 
                        `title`="Non-Event NRI", 
                        `type`="number"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="partialAUCTable",
                title="Partial AUC Analysis",
                visible="(partialAUC)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "partialAUCfrom",
                    "partialAUCto"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="pAUC", 
                        `title`="Partial AUC", 
                        `type`="number"),
                    list(
                        `name`="pAUC_normalized", 
                        `title`="Normalized pAUC", 
                        `type`="number"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="spec_range", 
                        `title`="Specificity Range", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="bootstrapCITable",
                title="Bootstrap Confidence Intervals",
                visible="(bootstrapCI)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "bootstrapReps"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="rocComparisonTable",
                title="Comprehensive Classifier Performance Comparison",
                visible="(compareClassifiers)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "positiveClass"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Test Variable", 
                        `type`="text"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number"),
                    list(
                        `name`="auprc", 
                        `title`="AUPRC", 
                        `type`="number"),
                    list(
                        `name`="brier", 
                        `title`="Brier Score", 
                        `type`="number"),
                    list(
                        `name`="f1_score", 
                        `title`="F1 Score", 
                        `type`="number"),
                    list(
                        `name`="accuracy", 
                        `title`="Accuracy", 
                        `type`="number"),
                    list(
                        `name`="balanced_accuracy", 
                        `title`="Balanced Accuracy", 
                        `type`="number"))))
            self$add(jmvcore::Array$new(
                options=options,
                name="plotROC",
                title="ROC Curves",
                visible="(plotROC)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "combinePlots",
                    "showOptimalPoint",
                    "cleanPlot"),
                template=jmvcore::Image$new(
                    options=options,
                    width=600,
                    height=500,
                    renderFun=".plotROC",
                    requiresData=TRUE)))
            self$add(jmvcore::Array$new(
                options=options,
                name="criterionPlot",
                title="Sensitivity and Specificity vs Threshold",
                visible="(showCriterionPlot)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "method",
                    "metric",
                    "direction"),
                template=jmvcore::Image$new(
                    options=options,
                    width=600,
                    height=450,
                    renderFun=".plotCriterion",
                    requiresData=TRUE)))
            self$add(jmvcore::Array$new(
                options=options,
                name="prevalencePlot",
                title="Predictive Values vs Disease Prevalence",
                visible="(showPrevalencePlot)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "method",
                    "metric"),
                template=jmvcore::Image$new(
                    options=options,
                    width=600,
                    height=450,
                    renderFun=".plotPrevalence",
                    requiresData=TRUE)))
            self$add(jmvcore::Array$new(
                options=options,
                name="dotPlot",
                title="Test Value Distribution by True Classification",
                visible="(showDotPlot)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "method",
                    "metric"),
                template=jmvcore::Image$new(
                    options=options,
                    width=600,
                    height=450,
                    renderFun=".plotDot",
                    requiresData=TRUE)))
            self$add(jmvcore::Array$new(
                options=options,
                name="precisionRecallPlot",
                title="Precision-Recall Curves",
                visible="(precisionRecallCurve)",
                clearWith=list(
                    "dependentVars",
                    "classVar",
                    "combinePlots"),
                template=jmvcore::Image$new(
                    options=options,
                    width=600,
                    height=500,
                    renderFun=".plotPrecisionRecall",
                    requiresData=TRUE)))
            self$add(jmvcore::Html$new(
                options=options,
                name="dotPlotMessage",
                title="Multiple Plot Information",
                visible="(showDotPlot && combinePlots)"))}))

psychopdarocBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "psychopdarocBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "psychopdaroc",
                version = c(0,0,3),
                options = options,
                results = psychopdarocResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' ROC Analysis
#'
#' Comprehensive Receiver Operating Characteristic (ROC) curve analysis for 
#' medical decision making. Calculates optimal cutpoints, compares multiple 
#' diagnostic tests, and provides detailed  performance metrics including AUC, 
#' sensitivity, specificity, and predictive values.
#' 
#'
#' @examples
#' \donttest{
#' # Basic ROC analysis
#' data(mtcars)
#' # Example will be added
#'}
#' @param data The data as a data frame.
#' @param dependentVars Variable(s) to be tested for classification
#'   performance. Must be numeric.
#' @param classVar Binary classification variable serving as the gold standard
#'   for comparison.
#' @param positiveClass Specifies which level of the class variable represents
#'   the positive case.
#' @param subGroup Optional variable for stratified analysis by subgroups.
#' @param method Method for determining the optimal cutpoint.
#' @param specifyCutScore Numeric value for custom cutpoint when using manual
#'   method.
#' @param metric Metric function used for cutpoint optimization.
#' @param direction Direction of classification relative to the cutpoint.
#' @param allObserved Whether to display all observed values as potential
#'   cutpoints.
#' @param break_ties Function for breaking ties when multiple optimal
#'   cutpoints exist.
#' @param tol_metric Tolerance for metric convergence in optimization methods.
#' @param boot_runs Number of bootstrap runs for bootstrap-based methods.
#' @param costRatioFP Cost ratio of false positives to false negatives for
#'   cost-sensitive optimization.
#' @param plotROC Whether to generate ROC curve plots.
#' @param combinePlots Whether to combine multiple ROC curves in one plot.
#' @param showOptimalPoint Whether to highlight the optimal cutpoint on ROC
#'   curves.
#' @param cleanPlot Create publication-ready plots with minimal annotations.
#' @param legendPosition Legend position for multiple ROC curve plots.
#' @param delongTest Whether to perform DeLong's test for comparing AUCs.
#' @param calculateIDI Whether to calculate Integrated Discrimination
#'   Improvement.
#' @param calculateNRI Whether to calculate Net Reclassification Index.
#' @param refVar Reference variable for IDI and NRI calculations.
#' @param nriThresholds Probability thresholds for categorical NRI
#'   calculation.
#' @param idiNriBootRuns Bootstrap iterations for IDI/NRI confidence
#'   intervals.
#' @param sensSpecTable Whether to display detailed sensitivity/specificity
#'   confusion matrices.
#' @param showThresholdTable Whether to display the threshold performance
#'   table.
#' @param maxThresholds Maximum number of thresholds to display in performance
#'   table.
#' @param showCriterionPlot Whether to display sensitivity/specificity vs
#'   threshold plots.
#' @param showPrevalencePlot Whether to display predictive values vs
#'   prevalence plots.
#' @param showDotPlot Whether to display dot plots of test value
#'   distributions.
#' @param precisionRecallCurve Whether to generate precision-recall curves.
#' @param partialAUC Whether to calculate partial AUC.
#' @param partialAUCfrom Lower specificity bound for partial AUC.
#' @param partialAUCto Upper specificity bound for partial AUC.
#' @param rocSmoothingMethod ROC curve smoothing method from pROC package.
#' @param bootstrapCI Whether to calculate bootstrap confidence intervals.
#' @param bootstrapReps Number of bootstrap replications for CI calculation.
#' @param compareClassifiers Whether to perform comprehensive classifier
#'   comparison.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$procedureNotes} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$aucSummaryTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$resultsTable} \tab \tab \tab \tab \tab an array of tables \cr
#'   \code{results$thresholdTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensSpecTable} \tab \tab \tab \tab \tab an array of htmls \cr
#'   \code{results$delongComparisonTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$delongTest} \tab \tab \tab \tab \tab a preformatted \cr
#'   \code{results$idiTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$nriTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$partialAUCTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$bootstrapCITable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$rocComparisonTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$plotROC} \tab \tab \tab \tab \tab an array of images \cr
#'   \code{results$criterionPlot} \tab \tab \tab \tab \tab an array of images \cr
#'   \code{results$prevalencePlot} \tab \tab \tab \tab \tab an array of images \cr
#'   \code{results$dotPlot} \tab \tab \tab \tab \tab an array of images \cr
#'   \code{results$precisionRecallPlot} \tab \tab \tab \tab \tab an array of images \cr
#'   \code{results$dotPlotMessage} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$aucSummaryTable$asDF}
#'
#' \code{as.data.frame(results$aucSummaryTable)}
#'
#' @export
psychopdaroc <- function(
    data,
    dependentVars,
    classVar,
    positiveClass,
    subGroup,
    method = "maximize_metric",
    specifyCutScore = "",
    metric = "youden",
    direction = ">=",
    allObserved = FALSE,
    break_ties = "mean",
    tol_metric = 0.05,
    boot_runs = 0,
    costRatioFP = 1,
    plotROC = TRUE,
    combinePlots = TRUE,
    showOptimalPoint = TRUE,
    cleanPlot = FALSE,
    legendPosition = "right",
    delongTest = FALSE,
    calculateIDI = FALSE,
    calculateNRI = FALSE,
    refVar,
    nriThresholds = "",
    idiNriBootRuns = 1000,
    sensSpecTable = FALSE,
    showThresholdTable = FALSE,
    maxThresholds = 20,
    showCriterionPlot = FALSE,
    showPrevalencePlot = FALSE,
    showDotPlot = FALSE,
    precisionRecallCurve = FALSE,
    partialAUC = FALSE,
    partialAUCfrom = 0.8,
    partialAUCto = 1,
    rocSmoothingMethod = "none",
    bootstrapCI = FALSE,
    bootstrapReps = 2000,
    compareClassifiers = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("psychopdaroc requires jmvcore to be installed (restart may be required)")

    if ( ! missing(dependentVars)) dependentVars <- jmvcore::resolveQuo(jmvcore::enquo(dependentVars))
    if ( ! missing(classVar)) classVar <- jmvcore::resolveQuo(jmvcore::enquo(classVar))
    if ( ! missing(subGroup)) subGroup <- jmvcore::resolveQuo(jmvcore::enquo(subGroup))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(dependentVars), dependentVars, NULL),
            `if`( ! missing(classVar), classVar, NULL),
            `if`( ! missing(subGroup), subGroup, NULL))

    for (v in classVar) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in subGroup) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- psychopdarocOptions$new(
        dependentVars = dependentVars,
        classVar = classVar,
        positiveClass = positiveClass,
        subGroup = subGroup,
        method = method,
        specifyCutScore = specifyCutScore,
        metric = metric,
        direction = direction,
        allObserved = allObserved,
        break_ties = break_ties,
        tol_metric = tol_metric,
        boot_runs = boot_runs,
        costRatioFP = costRatioFP,
        plotROC = plotROC,
        combinePlots = combinePlots,
        showOptimalPoint = showOptimalPoint,
        cleanPlot = cleanPlot,
        legendPosition = legendPosition,
        delongTest = delongTest,
        calculateIDI = calculateIDI,
        calculateNRI = calculateNRI,
        refVar = refVar,
        nriThresholds = nriThresholds,
        idiNriBootRuns = idiNriBootRuns,
        sensSpecTable = sensSpecTable,
        showThresholdTable = showThresholdTable,
        maxThresholds = maxThresholds,
        showCriterionPlot = showCriterionPlot,
        showPrevalencePlot = showPrevalencePlot,
        showDotPlot = showDotPlot,
        precisionRecallCurve = precisionRecallCurve,
        partialAUC = partialAUC,
        partialAUCfrom = partialAUCfrom,
        partialAUCto = partialAUCto,
        rocSmoothingMethod = rocSmoothingMethod,
        bootstrapCI = bootstrapCI,
        bootstrapReps = bootstrapReps,
        compareClassifiers = compareClassifiers)

    analysis <- psychopdarocClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

